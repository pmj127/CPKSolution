@{
    ViewBag.Title = "List";
    Layout = "~/Views/Shared/_Layout.cshtml";

}
<script src="~/Scripts/dist/jstree.js"></script>
<link rel="stylesheet" href="~/Scripts/dist/themes/default/style.css" />
<link rel="stylesheet" href="~/Content/dashboard.css" />
<div class="row"  style="margin-top: 5px;">
    <div class="col-sm-3 col-md-3 sidebar">
        <div class="modal-footer" style="margin-top: 5px; padding-top: 5px; text-align: center; border-top: 0px;">
            <button type="button" class="btn btn-info" id="btnAddGroup" data-toggle="modal" data-target="#addGroupPop">Add Group</button>
            <button type="button" class="btn btn-danger" id="btnRemoveGroup" data-toggle="modal" data-target="#removeGroupPop">Remove Group</button>
        </div>
        <div id="groupTree" style="min-width:300px;">
        </div>
    </div>
    <div class="col-sm-9 col-sm-offset-3 col-md-9 col-md-offset-3 main"  style="margin-top: 5px; padding-top: 5px;">
        <h2 style="margin-top: 5px;">CPK Solution</h2>
        <hr />
        <div class="upperPane" stlye="">
            <h3>Report List</h3>
            <div id="grid" style="min-width:250px;height:250px;overflow:auto;" >
                <div>
                    <table class="table table-striped table-bordered table-condensed table-hover">
                        <thead>
                            <tr>
                                <th data-column="ReportID" data-sort="true" data-align="center">Report ID</th>
                                <th data-column="ReportName" data-sort="true" data-search="true" data-action="grid_click">Report Name</th>
                                <th data-column="ReportPath">Report Path</th>
                                <th data-column="IsActive" data-align="center">Active</th>
                                <th data-column="ModifyDate" data-sort="true" data-align="center">Modify Date</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer" style="margin-top: 5px; padding-top: 5px; border-top: 0px;">
                <button type="button" class="btn btn-info" id="btnAddReportGroup"  data-toggle="modal" data-target="#addReportPop">Add Report to Group</button>
                <button type="button" class="btn btn-danger" id="btnRemoveReportGroup" data-toggle="modal" data-target="#removeReportPop">Remove Report from Group</button>
            </div>

        </div>
        <div style="height:10px;" ></div> 

        <div class="lowerPane">
            <h3>User List</h3>
            <div id="grid2" style="min-width:250px;height:185px;overflow:auto;">
                <div>
                    <table class="table table-striped table-bordered table-condensed table-hover">
                        <thead>
                            <tr>
                                <th data-column="UserID">UserID</th>
                                <th data-column="UserType" data-sort="true" data-align="center" data-action="grid_click">Type</th>
                                <th data-column="FullName" data-sort="true" data-search="true" data-action="grid_click">Name</th>
                                <th data-column="Account" data-sort="true" data-action="grid_click">Account ID</th>
                                <th data-column="Status" data-sort="true" data-action="grid_click">Status</th>
                                <th data-column="ModifyDate" data-sort="true" data-align="center" data-action="grid_click">Modify Date</th>
                            </tr>
                        </thead>
                        <tbody></tbody>
                    </table>
                </div>
            </div>
            <div class="modal-footer" style="margin-top: 5px; padding-top: 5px; border-top: 0px;">
                <button type="button" class="btn btn-info" id="btnAddUserGroup" data-toggle="modal" data-target="#addUserPop">Add User to Group</button>
                <button type="button" class="btn btn-danger" id="btnRemoveUserGroup"  data-toggle="modal" data-target="#removeUserPop">Remove User from Group</button>
            </div>
        </div>

    </div>
</div>
<div id="addGroupPop" class="modal fade" role="dialog" style="padding-top: 15%;" >
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Add Group</h4>
            </div>
            <div class="modal-body">
                <form id="formAddGoup">
                    <div class="form-group">
                        <label for="txtGroupName" class="control-label">Group Name:</label>
                        <input type="text" class="form-control" id="txtGroupName">
                    </div>
                    <div class="form-group">
                        <label for="txtDescription" class="control-label">Description:</label>
                        <input type="text" class="form-control" id="txtDescription">
                    </div>
                    <div class="form-group">
                        <label for="selGroup" class="control-label">Parent Group:</label>
                        <select id="selGroup">
                        </select>
                    </div>               
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="formAddGoupSave">Add</button>
            </div>
        </div>
    </div>
</div>
<div id="removeGroupPop" class="modal fade" role="dialog" style="padding-top: 15%;">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 class="modal-title" >Remove Group</h4>
            </div>
            <div class="modal-body">
                <form id="formRemoveGoup">
                    <div class="form-group">
                        <label for="selGroupRemove" class="control-label">Parent Group:</label>
                        <select id="selGroupRemove"></select>
                    </div>
                    <div class="form-group">
                        <label for="txtGroupNameRemove" class="control-label">Group Name:</label>
                        <input type="text" class="form-control" id="txtGroupNameRemove">
                    </div>
                    <div class="form-group">
                        <label for="txtDescriptionRemove" class="control-label">Description:</label>
                        <input type="text" class="form-control" id="txtDescriptionRemove">
                    </div>

                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" id="formAddGoupSave">Remove</button>
            </div>
        </div>
    </div>
</div>
<div id="addReportPop" class="modal fade" role="dialog" >

</div>
<div id="removeReportPop" class="modal fade" role="dialog"  >

</div>
<div id="addUserPop" class="modal fade" role="dialog"  >

</div>
<div id="removeUserPop" class="modal fade" role="dialog"  >

</div>


<script type="text/javascript">

    $(function () {
        $("#grid").moonGrid({
            pageNo: 1,
            pageSize: 1000,
            searchText: null,
            filterText: 0,
            orderColumn: null,
            orderDesc: null,
            url:"@Url.Action("GetListByGroup", "ReportView")",
            sync: true,
            showPager: false,
            showSort: true,
            showSearcher: false,
            showModal: false
        });
    });

    function grid_click(event)
    {
        //event.data.row has all row information such as ReportID, ReportName, and so on
        //alert(event.data.row.ReportID);
        //window.location.href = "/ReportView/Details?id=" + event.data.row.ReportID;
        window.location.href = "/ReportView/Index?ReportID=" + event.data.row.ReportID + "&width=100&height=650";
        //window.location.href = "@Url.Action("Details", "ReportView", new { id = "reportId" })".replace("reportId", event.data.row.ReportID);
    }
    //function grid_radio_click(event) {
    //    //event.data.row has all row information such as ReportID, ReportName, and so on
    //    //alert(event.data.row.ReportID);
    //    window.location.href = "/ReportView/Index?ReportID=" + event.data.row.ReportID + "&width=100&height=650";
    //}

    $(function () {
        $("#grid2").moonGrid({
            pageNo: 1,
            pageSize: 1000,
            searchText: null,
            filterText: 0,
            orderColumn: null,
            orderDesc: null,
            url: "@Url.Action("GetListByGroup", "Account")",
            sync: true,
            showPager: false,
            showSort: true,
            showSearcher: false,
            showModal: false
        });
    });

    function grid_click(event) {
        window.location.href = "/Account/UserInfo?id=" + event.data.row.UserID;
    }

    $(document).ready(init);

    function init() {
        reloadTree();
        jsTreeSelected();
        $('#formAddGoupSave').on('click', formAddGoupSave_click);

    }

    function formAddGoupSave_click() {
        $.ajax({
            method: "POST",
            url: "@Url.Action("Add", "Group")",
            data: {
                GroupName: $("#txtGroupName").val(),
                Description: $("#txtDescription").val(),
                ParentGroup: $("#selGroup").val()
            }
        }).done(function (html) {
            reloadTree();
        });

    }

    function setGroupSelect(name) {
        var treeData = $('#groupTree').jstree(true).get_json('#', { flat: true });
        if ($("#" + name).size() <= 1)
        {
            $(treeData).each(function (index, o) {
                var $option = $("<option/>").attr("value", o.id).text(o.text);
                $("#" + name).append($option);
            });
            return true;
        }

    }

    function jsTreeSelected() {
        $('#groupTree').on('select_node.jstree', function (e, data) {
            var i, j, r = [];
            for (i = 0, j = data.selected.length; i < j; i++) {
                r.push(data.instance.get_node(data.selected[i]).id);
            }
            var selId = r.join(', ');
            //console.info("r.join(', '):" + selId);
            $("#gridFilterTextHidden").val(selId);
            $("#gridRefresh").trigger("click");
            $("#grid2FilterTextHidden").val(selId);
            $("#grid2Refresh").trigger("click");
            //setGroupSelect();
        }).jstree();

    }

    function reloadTree() {
        $('#groupTree').jstree({
            'core': {
                'data': {
                    'url': "@Url.Action("GetList", "Group")",
                    'data': function (arg) {
                        arg = arg;
                        return { 'UserId': 0, 'GroupId': 0 };
                    }
                }
            }
        });


    }

    $('#addGroupPop').on('show.bs.modal', function (event) {
        setGroupSelect("selGroup");
    })

    $('#removeGroupPop').on('show.bs.modal', function (event) {
        setGroupSelect("selGroupRemove");
    })

</script>

@section Scripts {
    @Styles.Render("~/Content/moonGrid")
    @Scripts.Render("~/bundles/moonGrid")
}




